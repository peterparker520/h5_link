# æ—¶å…‰æ‹ H5 è§†é¢‘åˆ†äº«è½åœ°é¡µ

ä¸€ä¸ªåŸºäº React + Vite æ„å»ºçš„ç°ä»£åŒ– H5 è§†é¢‘åˆ†äº«è½åœ°é¡µåº”ç”¨ï¼Œæ”¯æŒç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯è‡ªé€‚åº”å±•ç¤ºï¼Œä¸“ä¸º"æ—¶å…‰æ‹"è§†é¢‘ç¤¾åŒºæ‰“é€ ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ åŠŸèƒ½ç‰¹æ€§
- **åŠ¨æ€è§†é¢‘åŠ è½½**ï¼šé€šè¿‡ URL å‚æ•° `video_id` åŠ¨æ€è·å–å¹¶å±•ç¤ºè§†é¢‘å†…å®¹
- **å“åº”å¼è®¾è®¡**ï¼šè‡ªåŠ¨è¯†åˆ«è®¾å¤‡ç±»å‹ï¼Œæä¾›ç§»åŠ¨ç«¯å’Œæ¡Œé¢ç«¯ä¸åŒçš„ UI ä½“éªŒ
- **æ™ºèƒ½è·¯ç”±ç®¡ç†**ï¼šåŸºäº React Router å®ç° SPA å•é¡µåº”ç”¨ï¼Œæ”¯æŒæµè§ˆå™¨å†å²è®°å½•
- **å®æ—¶çª—å£é€‚é…**ï¼šç›‘å¬çª—å£å¤§å°å˜åŒ–ï¼ŒåŠ¨æ€åˆ‡æ¢ç§»åŠ¨ç«¯/æ¡Œé¢ç«¯è§†å›¾
- **å®Œå–„çš„é”™è¯¯å¤„ç†**ï¼šä¼˜é›…å¤„ç†è§†é¢‘ä¸å­˜åœ¨ã€å·²åˆ é™¤ç­‰å¼‚å¸¸æƒ…å†µ
- **åŠ è½½çŠ¶æ€ç®¡ç†**ï¼šæä¾›å‹å¥½çš„åŠ è½½åŠ¨ç”»å’Œç©ºçŠ¶æ€æç¤º

### ğŸ“± é¡µé¢ç»„ä»¶
- **VideoSharePage (ç§»åŠ¨ç«¯)**ï¼šç§»åŠ¨ç«¯è§†é¢‘è¯¦æƒ…é¡µï¼ŒåŒ…å«è§†é¢‘æ’­æ”¾ã€ç”¨æˆ·ä¿¡æ¯ã€è¯„è®ºäº’åŠ¨
- **VideoSharePage_Desktop (æ¡Œé¢ç«¯)**ï¼šæ¡Œé¢ç«¯è§†é¢‘è¯¦æƒ…é¡µï¼Œé‡‡ç”¨å·¦å³åˆ†æ å¸ƒå±€
- **DownloadPage**ï¼šAPP ä¸‹è½½å¼•å¯¼é¡µï¼Œå¸¦èƒŒæ™¯å›¾å’Œä¸‹è½½æŒ‰é’®
- **BlankPage**ï¼šå†…å®¹ä¸å­˜åœ¨æç¤ºé¡µ
- **LoadingPage**ï¼šæ•°æ®åŠ è½½ä¸­é¡µé¢

### ğŸ¨ æŠ€æœ¯äº®ç‚¹
- **iOS å¾®ä¿¡è§†é¢‘ä¼˜åŒ–**ï¼šé’ˆå¯¹ iOS å¾®ä¿¡ç¯å¢ƒçš„è§†é¢‘æ’­æ”¾è¿›è¡Œæ·±åº¦ä¼˜åŒ–ï¼Œè§£å†³é»‘å±ã€å¡é¡¿ç­‰é—®é¢˜
- **GPU æ¸²æŸ“åŠ é€Ÿ**ï¼šä½¿ç”¨ CSS3 transform å’Œ will-change å±æ€§æ¿€æ´»ç¡¬ä»¶åŠ é€Ÿ
- **æ™ºèƒ½æ—¶é—´æ ¼å¼åŒ–**ï¼šç›¸å¯¹æ—¶é—´æ˜¾ç¤ºï¼ˆåˆšåˆšã€Xåˆ†é’Ÿå‰ã€Xå¤©å‰ç­‰ï¼‰
- **äºŒç»´ç ä¸‹è½½å¼•å¯¼**ï¼šæ¡Œé¢ç«¯æä¾›äºŒç»´ç æ‰«æä¸‹è½½åŠŸèƒ½

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

| ç±»åˆ« | æŠ€æœ¯/å·¥å…· | ç‰ˆæœ¬ |
|------|----------|------|
| **å‰ç«¯æ¡†æ¶** | React | 19.1.1 |
| **æ„å»ºå·¥å…·** | Vite | 7.1.7 |
| **è·¯ç”±ç®¡ç†** | React Router DOM | 7.9.4 |
| **ä»£ç è§„èŒƒ** | ESLint | 9.36.0 |
| **å¼€å‘è¯­è¨€** | JavaScript (ES6+) | - |
| **æ ·å¼æ–¹æ¡ˆ** | CSS3 | - |

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
h5_link/
â”œâ”€â”€ public/                      # é™æ€èµ„æº
â”‚   â””â”€â”€ logo.png                # åº”ç”¨ Logo
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/             # é¡µé¢ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ VideoSharePage.jsx         # ç§»åŠ¨ç«¯è§†é¢‘è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ VideoSharePage.css
â”‚   â”‚   â”œâ”€â”€ VideoSharePage_Desktop.jsx # æ¡Œé¢ç«¯è§†é¢‘è¯¦æƒ…é¡µ
â”‚   â”‚   â”œâ”€â”€ VideoSharePage_Desktop.css
â”‚   â”‚   â”œâ”€â”€ DownloadPage.jsx           # ä¸‹è½½é¡µ
â”‚   â”‚   â”œâ”€â”€ DownloadPage.css
â”‚   â”‚   â”œâ”€â”€ BlankPage.jsx              # ç©ºç™½æç¤ºé¡µ
â”‚   â”‚   â”œâ”€â”€ BlankPage.css
â”‚   â”‚   â”œâ”€â”€ Loading.jsx                # åŠ è½½é¡µ
â”‚   â”‚   â””â”€â”€ Loading.css
â”‚   â”œâ”€â”€ img/                    # å›¾ç‰‡èµ„æº
â”‚   â”‚   â”œâ”€â”€ image.png          # ä¸‹è½½é¡µèƒŒæ™¯å›¾
â”‚   â”‚   â””â”€â”€ qr_code.png        # APP ä¸‹è½½äºŒç»´ç 
â”‚   â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”‚   â””â”€â”€ timeFormatter.js   # æ—¶é—´æ ¼å¼åŒ–å·¥å…·
â”‚   â”œâ”€â”€ App.jsx                 # ä¸»åº”ç”¨ç»„ä»¶ï¼ˆè·¯ç”±ä¸æ ¸å¿ƒé€»è¾‘ï¼‰
â”‚   â”œâ”€â”€ App.css                 # ä¸»åº”ç”¨æ ·å¼
â”‚   â”œâ”€â”€ api.js                  # API æ¥å£å°è£…
â”‚   â”œâ”€â”€ main.jsx                # åº”ç”¨å…¥å£
â”‚   â””â”€â”€ index.css               # å…¨å±€æ ·å¼
â”œâ”€â”€ dist/                       # æ„å»ºè¾“å‡ºç›®å½•
â”œâ”€â”€ index.html                  # HTML æ¨¡æ¿
â”œâ”€â”€ vite.config.js             # Vite é…ç½®ï¼ˆå«å¼€å‘ä»£ç†ï¼‰
â”œâ”€â”€ eslint.config.js           # ESLint é…ç½®
â”œâ”€â”€ package.json               # é¡¹ç›®ä¾èµ–
â””â”€â”€ README.md                  # é¡¹ç›®æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Node.js**: >= 16.0.0
- **npm**: >= 7.0.0

### å®‰è£…ä¾èµ–

```bash
npm install
```

### å¼€å‘æ¨¡å¼

```bash
npm run dev
```

å¼€å‘æœåŠ¡å™¨å°†åœ¨ `http://localhost:5173` å¯åŠ¨ã€‚

**è®¿é—®ç¤ºä¾‹**ï¼š
```
http://localhost:5173/?video_id=10904038
```

### æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

æ„å»ºäº§ç‰©å°†è¾“å‡ºåˆ° `dist/` ç›®å½•ã€‚

### é¢„è§ˆç”Ÿäº§æ„å»º

```bash
npm run preview
```

### ä»£ç æ£€æŸ¥

```bash
npm run lint
```

## ğŸ”§ æ ¸å¿ƒåŠŸèƒ½è¯¦è§£

### 1. è·¯ç”±ç³»ç»Ÿ

åº”ç”¨ä½¿ç”¨ React Router DOM å®ç°ä»¥ä¸‹è·¯ç”±ï¼š

| è·¯ç”± | ç»„ä»¶ | è¯´æ˜ |
|------|------|------|
| `/` | LoadingPage | é¦–é¡µåŠ è½½é¡µï¼Œè·å–è§†é¢‘æ•°æ®åè‡ªåŠ¨è·³è½¬ |
| `/mobile` | VideoSharePage | ç§»åŠ¨ç«¯è§†é¢‘è¯¦æƒ…é¡µ |
| `/desktop` | VideoSharePage_Desktop | æ¡Œé¢ç«¯è§†é¢‘è¯¦æƒ…é¡µ |
| `/download` | DownloadPage | APP ä¸‹è½½é¡µ |
| `/blank` | BlankPage | å†…å®¹ä¸å­˜åœ¨æç¤ºé¡µ |

### 2. API æ¥å£

**API åŸºç¡€åœ°å€**ï¼š`/api` (å¼€å‘ç¯å¢ƒé€šè¿‡ Vite ä»£ç†åˆ° `https://sgp-test.xinpianchang.com`)

**æ¥å£åˆ—è¡¨**ï¼š

```javascript
// è·å–è§†é¢‘è¯¦æƒ…
POST /api/v1/content/video/detail
Body: { video_id: number }

// è·å–è§†é¢‘è¯„è®ºåˆ—è¡¨
POST /api/v1/content/video/comment/list
Body: { video_id: number }

// è·å–æ¨¡æ¿åˆ†ç±»åç§°
POST /api/v1/distribute/template/category_names
Body: { template_id: number }
```


### 3. æ•°æ®æµè½¬

```
URL (?video_id=xxx)
    â†“
App.jsx (æå– video_id)
    â†“
api.js (å¹¶è¡Œè¯·æ±‚è§†é¢‘è¯¦æƒ…ã€è¯„è®ºã€åˆ†ç±»)
    â†“
åˆ¤æ–­è®¾å¤‡ç±»å‹ (window.innerWidth <= 768)
    â†“
è·¯ç”±è·³è½¬ (/mobile æˆ– /desktop)
    â†“
é¡µé¢ç»„ä»¶æ¸²æŸ“ (é€šè¿‡ location.state æ¥æ”¶æ•°æ®)
```

### 4. å“åº”å¼é€‚é…

- **æ–­ç‚¹**ï¼š768px
- **ç§»åŠ¨ç«¯** (â‰¤768px)ï¼šå•åˆ—å¸ƒå±€ï¼Œè§†é¢‘å…¨å±å±•ç¤º
- **æ¡Œé¢ç«¯** (>768px)ï¼šå·¦å³åˆ†æ ï¼Œå·¦ä¾§è§†é¢‘å†…å®¹ï¼Œå³ä¾§ä¸‹è½½å¼•å¯¼

**åŠ¨æ€åˆ‡æ¢**ï¼šç›‘å¬ `window.resize` äº‹ä»¶ï¼Œå®æ—¶åˆ‡æ¢è·¯ç”±

### 5. iOS å¾®ä¿¡è§†é¢‘ä¼˜åŒ–

é’ˆå¯¹ iOS å¾®ä¿¡æµè§ˆå™¨çš„è§†é¢‘æ’­æ”¾é—®é¢˜ï¼Œå®ç°äº†ä»¥ä¸‹ä¼˜åŒ–ï¼š

```javascript
// 1. è®¾ç½®å†…è”æ’­æ”¾å±æ€§
video.setAttribute('webkit-playsinline', 'true')
video.setAttribute('x5-playsinline', 'true')

// 2. æ¿€æ´» GPU æ¸²æŸ“
video.style.transform = 'translateZ(0)'
video.style.willChange = 'transform'

// 3. å®šæ—¶å™¨ä¿æ´»æœºåˆ¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
// é€šè¿‡å¾®å°çš„ transform æŠ–åŠ¨ä¿æŒ GPU åˆæˆå±‚æ´»è·ƒ

// 4. å¼ºåˆ¶åˆ·æ–°è§†é¢‘å¸§
video.currentTime = currentTime + 0.001
```

### 6. æ—¶é—´æ ¼å¼åŒ–

`utils/timeFormatter.js` æä¾›æ™ºèƒ½æ—¶é—´æ˜¾ç¤ºï¼š

- **0-59ç§’**ï¼šåˆšåˆš
- **1-59åˆ†é’Ÿ**ï¼šXåˆ†é’Ÿå‰
- **1-23å°æ—¶**ï¼šXå°æ—¶å‰
- **1-7å¤©**ï¼šXå¤©å‰
- **7å¤©ä»¥ä¸Šï¼ˆå½“å¹´ï¼‰**ï¼šMæœˆDæ—¥
- **è·¨å¹´**ï¼šYYYYå¹´MæœˆDæ—¥

## âš™ï¸ é…ç½®è¯´æ˜

### Vite é…ç½® (vite.config.js)

```javascript
export default defineConfig({
  plugins: [react()],
  server: {
    proxy: {
      '/api': {
        target: 'https://sgp-test.xinpianchang.com',
        changeOrigin: true,
        secure: true,
        rewrite: (path) => path
      }
    }
  }
})
```

### HTML é…ç½® (index.html)

```html
<!-- ç§»åŠ¨ç«¯é€‚é… -->
<meta name="viewport"
  content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
```

## ğŸš¢ éƒ¨ç½²æŒ‡å—

### é™æ€æ‰˜ç®¡ + API ä»£ç†

1. **æ„å»ºé¡¹ç›®**
```bash
npm run build
```

2. **é…ç½® Nginx åå‘ä»£ç†**
```nginx
server {
    listen 80 ; 
    listen 443 ssl http2 ; 
    server_name h5-link.incandescent.top; 
    index index.php index.html index.htm default.php default.htm default.html; 
    proxy_set_header Host $host; 
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; 
    proxy_set_header X-Forwarded-Host $server_name; 
    proxy_set_header X-Real-IP $remote_addr; 
    proxy_http_version 1.1; 
    proxy_set_header Upgrade $http_upgrade; 
    proxy_set_header Connection $http_connection; 
    access_log /www/sites/h5-link.incandescent.top/log/access.log main; 
    error_log /www/sites/h5-link.incandescent.top/log/error.log; 
    location ^~ /.well-known/acme-challenge {
        allow all; 
        root /usr/share/nginx/html; 
    }
    location /api/ {
        proxy_pass https://sgp-test.xinpianchang.com;  
        proxy_set_header Host sgp-test.xinpianchang.com;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_http_version 1.1;
        proxy_set_header Connection "";

        proxy_redirect off;
        proxy_ssl_server_name on;
        proxy_ssl_verify off; 
    }

    root /www/sites/h5-link.incandescent.top/index; 
    error_page 404 /404.html; 
    if ($scheme = http) {
        return 301 https://$host$request_uri; 
    }
    ssl_certificate /www/sites/h5-link.incandescent.top/ssl/fullchain.pem; 
    ssl_certificate_key /www/sites/h5-link.incandescent.top/ssl/privkey.pem; 
    ssl_protocols TLSv1.3 TLSv1.2 TLSv1.1 TLSv1; 
    ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-SHA384:ECDHE-RSA-AES128-SHA256:!aNULL:!eNULL:!EXPORT:!DSS:!DES:!RC4:!3DES:!MD5:!PSK:!KRB5:!SRP:!CAMELLIA:!SEED; 
    ssl_prefer_server_ciphers on; 
    ssl_session_cache shared:SSL:10m; 
    ssl_session_timeout 10m; 
    error_page 497 https://$host$request_uri; 
    proxy_set_header X-Forwarded-Proto https; 
    add_header Strict-Transport-Security "max-age=31536000"; 

    location / {
        try_files $uri $uri/ /index.html;
    }
}
```

## ğŸ“ å¼€å‘æ³¨æ„äº‹é¡¹

1. **è§†é¢‘æ’­æ”¾**ï¼šiOS å¾®ä¿¡ç¯å¢ƒéœ€è¦ç‰¹æ®Šå¤„ç†ï¼Œå·²åœ¨ä»£ç ä¸­å®ç°
2. **API ä»£ç†**ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦é…ç½®æœåŠ¡å™¨ç«¯ä»£ç†æˆ– CORS
3. **å›¾ç‰‡èµ„æº**ï¼šç¡®ä¿ `public/logo.png` å’Œ `src/img/` ä¸‹çš„å›¾ç‰‡å­˜åœ¨
4. **è·¯ç”±æ¨¡å¼**ï¼šä½¿ç”¨ BrowserRouterï¼Œéœ€è¦æœåŠ¡å™¨æ”¯æŒ History æ¨¡å¼

## ğŸ› å¸¸è§é—®é¢˜

**Q: è§†é¢‘åœ¨ iOS å¾®ä¿¡ä¸­æ’­æ”¾é»‘å±ï¼Ÿ**
A: å·²é€šè¿‡ GPU æ¸²æŸ“ä¼˜åŒ–å’Œå®šæ—¶å™¨ä¿æ´»æœºåˆ¶è§£å†³ã€‚

**Q: é¡µé¢åˆ·æ–°å 404ï¼Ÿ**
A: éœ€è¦é…ç½®æœåŠ¡å™¨å°†æ‰€æœ‰è·¯ç”±æŒ‡å‘ `index.html`ã€‚

**Q: API è¯·æ±‚è·¨åŸŸï¼Ÿ**
A: å¼€å‘ç¯å¢ƒå·²é…ç½® Vite ä»£ç†ï¼Œç”Ÿäº§ç¯å¢ƒéœ€é…ç½®æœåŠ¡å™¨ç«¯ä»£ç†ã€‚

## ğŸ“œ å¯ç”¨è„šæœ¬

- `npm run dev`: å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨
- `npm run build`: æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- `npm run lint`: è¿è¡Œ ESLint ä»£ç æ£€æŸ¥
- `npm run preview`: é¢„è§ˆç”Ÿäº§æ„å»º

